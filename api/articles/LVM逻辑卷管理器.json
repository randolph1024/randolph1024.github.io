{"title":"LVM逻辑卷管理器","uid":"5807d01a83cab541c255c8528031d9c8","slug":"LVM逻辑卷管理器","date":"2021-11-30T04:40:31.000Z","updated":"2024-04-08T05:56:00.000Z","comments":true,"path":"api/articles/LVM逻辑卷管理器.json","keywords":null,"cover":"/img/lvm.jpeg","content":"<h3 id=\"部署逻辑卷\"><a href=\"#部署逻辑卷\" class=\"headerlink\" title=\"部署逻辑卷\"></a>部署逻辑卷</h3><pre><code class=\"highlight plaintext\">查看当前磁盘\n[root@localhost randy]# ls /dev/sd*\n/dev/sda  /dev/sda1  /dev/sda2  /dev/sdb  /dev/sdc  /dev/sdd  /dev/sde\n创建逻辑卷\n[root@localhost randy]# pvcreate /dev/sd[b-c]\n  Physical volume &quot;/dev/sdb&quot; successfully created.\n  Physical volume &quot;/dev/sdc&quot; successfully created.\n创建逻辑卷组\n[root@localhost randy]# vgcreate ran /dev/sd[b-c]\n  Volume group &quot;ran&quot; successfully created\n逻辑卷组切割  -l制定单元大小    -L制定容量大小\n[root@localhost randy]# lvcreate -n ra -L 30G ran\n  Logical volume &quot;ra&quot; created.\n  \nLVM仅支持ext3 or 4文件系统\n格式化\nroot@localhost randy]# mkfs.ext4 /dev/ran/ra\nmke2fs 1.42.9 (28-Dec-2013)\nFilesystem label=\nOS type: Linux\nBlock size=4096 (log=2)\nFragment size=4096 (log=2)\nStride=0 blocks, Stripe width=0 blocks\n1966080 inodes, 7864320 blocks\n393216 blocks (5.00%) reserved for the super user\nFirst data block=0\nMaximum filesystem blocks=2155872256\n240 block groups\n32768 blocks per group, 32768 fragments per group\n8192 inodes per group\nSuperblock backups stored on blocks: \n    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, \n    4096000\n\nAllocating group tables: done                            \nWriting inode tables: done                            \nCreating journal (32768 blocks): done\nWriting superblocks and filesystem accounting information: done\n\n挂载\n[root@localhost randy]# mkdir /hh\n[root@localhost randy]# vim /etc/fstab\n/dev/ran/ra ext4 defaults 0 0\n自动挂载\n[root@localhost randy]# mount -a\n查看挂载（磁盘格式化相关文件系统后内存略有缩水）\n[root@localhost randy]# df -h\nFilesystem               Size  Used Avail Use% Mounted on\n/dev/mapper/centos-root   30G  4.5G   25G  16% /\ndevtmpfs                 3.8G     0  3.8G   0% /dev\ntmpfs                    3.9G     0  3.9G   0% /dev/shm\ntmpfs                    3.9G   13M  3.8G   1% /run\ntmpfs                    3.9G     0  3.9G   0% /sys/fs/cgroup\n/dev/sda1                297M  153M  145M  52% /boot\ntmpfs                    781M  4.0K  781M   1% /run/user/42\ntmpfs                    781M   24K  781M   1% /run/user/1000\n/dev/sr0                 4.2G  4.2G     0 100% /run/media/randy/CentOS 7 x86_64\n/dev/mapper/ran-ra        30G   45M   28G   1% /hh</code></pre>\n\n<h3 id=\"扩容逻辑卷\"><a href=\"#扩容逻辑卷\" class=\"headerlink\" title=\"扩容逻辑卷\"></a>扩容逻辑卷</h3><pre><code class=\"highlight plaintext\">[randy@localhost ~]$ df -h\n文件系统                 容量  已用  可用 已用% 挂载点\n/dev/mapper/centos-root   30G  3.4G   26G   12% /\ndevtmpfs                 1.7G     0  1.7G    0% /dev\ntmpfs                    1.8G     0  1.8G    0% /dev/shm\ntmpfs                    1.8G   13M  1.7G    1% /run\ntmpfs                    1.8G     0  1.8G    0% /sys/fs/cgroup\n/dev/sda1                297M  153M  145M   52% /boot\n/dev/mapper/ran-ra       9.8G   37M  9.2G    1% /hh\ntmpfs                    351M  4.0K  351M    1% /run/user/42\ntmpfs                    351M   24K  351M    1% /run/user/1000\n/dev/sr0                 4.2G  4.2G     0  100% /run/media/randy/CentOS 7 x86_64\n卸载逻辑卷\n[root@localhost randy]# umount /hh\n扩展逻辑卷容量\n[root@localhost randy]# lvextend -L +300M /dev/ran/ra\n  Size of logical volume ran/ra changed from 10.00 GiB (2560 extents) to 10.29 GiB (2635 extents).\n  Logical volume ran/ra successfully resized.\n检查硬盘的完整性，确认目录结构、内容和文件内容没有丢失。一般情况下没有报错，均为正常情况\n[root@localhost randy]# e2fsck -f /dev/ran/ra\ne2fsck 1.42.9 (28-Dec-2013)\n第一步: 检查inode,块,和大小\n第二步: 检查目录结构\n第3步: 检查目录连接性\nPass 4: Checking reference counts\n第5步: 检查簇概要信息\n/dev/ran/ra: 11/655360 files (0.0% non-contiguous), 83137/2621440 blocks\n重置设备在系统中的容量。刚刚是对LV（逻辑卷）设备进行了扩容操作，但系统内核还没有同步到这部分新修改的信息，需要手动进行同步\n[root@localhost randy]# resize2fs /dev/ran/ra\nresize2fs 1.42.9 (28-Dec-2013)\nResizing the filesystem on /dev/ran/ra to 2698240 (4k) blocks.\nThe filesystem on /dev/ran/ra is now 2698240 blocks long.\n\n自动挂载\n[root@localhost randy]# mount -a\n[root@localhost randy]# df -h\n文件系统                 容量  已用  可用 已用% 挂载点\n/dev/mapper/centos-root   30G  3.4G   26G   12% /\ndevtmpfs                 1.7G     0  1.7G    0% /dev\ntmpfs                    1.8G     0  1.8G    0% /dev/shm\ntmpfs                    1.8G   13M  1.7G    1% /run\ntmpfs                    1.8G     0  1.8G    0% /sys/fs/cgroup\n/dev/sda1                297M  153M  145M   52% /boot\ntmpfs                    351M  4.0K  351M    1% /run/user/42\ntmpfs                    351M   24K  351M    1% /run/user/1000\n/dev/sr0                 4.2G  4.2G     0  100% /run/media/randy/CentOS 7 x86_64\n/dev/mapper/ran-ra        11G   41M  9.5G    1% /hh</code></pre>\n\n<h3 id=\"缩小逻辑卷\"><a href=\"#缩小逻辑卷\" class=\"headerlink\" title=\"缩小逻辑卷\"></a>缩小逻辑卷</h3><pre><code class=\"highlight plaintext\">[root@localhost randy]# umount /hh\n检查磁盘是否有损坏   \n[root@localhost randy]# e2fsck -f /dev/ran/ra\ne2fsck 1.42.9 (28-Dec-2013)\n第一步: 检查inode,块,和大小\n第二步: 检查目录结构\n第3步: 检查目录连接性\nPass 4: Checking reference counts\n第5步: 检查簇概要信息\n/dev/ran/ra: 11/679936 files (0.0% non-contiguous), 85706/2698240 blocks\n通知系统将内存修改到5G\n[root@localhost randy]# resize2fs /dev/ran/ra 5G\nresize2fs 1.42.9 (28-Dec-2013)\nResizing the filesystem on /dev/ran/ra to 1310720 (4k) blocks.\nThe filesystem on /dev/ran/ra is now 1310720 blocks long.\nLv命令缩减空间\n[root@localhost randy]# lvreduce -L 5G /dev/ran/ra\n  WARNING: Reducing active logical volume to 5.00 GiB.\n  THIS MAY DESTROY YOUR DATA (filesystem etc.)\nDo you really want to reduce ran/ra? [y/n]: y\n  Size of logical volume ran/ra changed from 10.29 GiB (2635 extents) to 5.00 GiB (1280 extents).\n  Logical volume ran/ra successfully resized.\n自动挂载\n[root@localhost randy]# mount -a\n[root@localhost randy]# df -h\n文件系统                 容量  已用  可用 已用% 挂载点\n/dev/mapper/centos-root   30G  3.4G   26G   12% /\ndevtmpfs                 1.7G     0  1.7G    0% /dev\ntmpfs                    1.8G     0  1.8G    0% /dev/shm\ntmpfs                    1.8G   13M  1.7G    1% /run\ntmpfs                    1.8G     0  1.8G    0% /sys/fs/cgroup\n/dev/sda1                297M  153M  145M   52% /boot\ntmpfs                    351M  4.0K  351M    1% /run/user/42\ntmpfs                    351M   28K  351M    1% /run/user/1000\n/dev/sr0                 4.2G  4.2G     0  100% /run/media/randy/CentOS 7 x86_64\n/dev/mapper/ran-ra       4.8G   33M  4.5G    1% /hh</code></pre>\n\n<h3 id=\"逻辑卷快照\"><a href=\"#逻辑卷快照\" class=\"headerlink\" title=\"逻辑卷快照\"></a>逻辑卷快照</h3><pre><code class=\"highlight plaintext\">[randy@localhost ~]$ df -h\n文件系统                 容量  已用  可用 已用% 挂载点\n/dev/mapper/centos-root   30G  3.4G   26G   12% /\ndevtmpfs                 1.7G     0  1.7G    0% /dev\ntmpfs                    1.8G     0  1.8G    0% /dev/shm\ntmpfs                    1.8G   13M  1.7G    1% /run\ntmpfs                    1.8G     0  1.8G    0% /sys/fs/cgroup\n/dev/sda1                297M  153M  145M   52% /boot\n/dev/mapper/ran-ra       4.8G   33M  4.5G    1% /hh\ntmpfs                    351M  4.0K  351M    1% /run/user/42\ntmpfs                    351M   20K  351M    1% /run/user/1000\n/dev/sr0                 4.2G  4.2G     0  100% /run/media/randy/CentOS 7 x86_64\n查看逻辑卷剩余和使用的内存\n[root@localhost randy]# vgdisplay\n  --- Volume group ---\n  VG Name               ran\n  System ID             \n  Format                lvm2\n  Metadata Areas        2\n  Metadata Sequence No  4\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                1\n  Open LV               1\n  Max PV                0\n  Cur PV                2\n  Act PV                2\n  VG Size               39.99 GiB\n  PE Size               4.00 MiB\n  Total PE              10238\n  Alloc PE / Size       1280 / 5.00 GiB\n  Free  PE / Size       8958 / 34.99 GiB\n  VG UUID               4URcXh-G5x8-1I9u-G7q0-1cI2-R1dK-ylqEIM\n   \n  --- Volume group ---\n写入一个测试文件\n[root@localhost randy]# echo &quot;this is test file context let&#x27;s say hello word&quot; &gt; /hh/readme.txt\n[root@localhost randy]# ll /hh\n总用量 20\ndrwx------. 2 root root 16384 11月 29 09:08 lost+found\n-rw-r--r--. 1 root root    47 11月 29 15:21 readme.txt\n使使用-s参数生成一个快照卷，使用-L参数指定切割的大小，需要与要做快照的设备容量保持一致。另外，还需要在命令后面写上是针对哪个逻辑卷执行的快照操作，稍后数据也会还原到这个相应的设备上\n[root@localhost randy]# lvcreate -s -n snap -L 5G /dev/ran/ra\n  Logical volume &quot;snap&quot; created.\n[root@localhost randy]# dd if=/dev/zero of=/hh/files count=1 bs=100M\n记录了1+0 的读入\n记录了1+0 的写出\n104857600字节(105 MB)已复制，0.638687 秒，164 MB/秒\n查看生成文件\n[root@localhost randy]# ll /hh\n总用量 102420\n-rw-r--r--. 1 root root 104857600 11月 29 16:05 files\ndrwx------. 2 root root     16384 11月 29 09:08 lost+found\n-rw-r--r--. 1 root root        47 11月 29 15:21 readme.txt\n取消挂载\n[root@localhost randy]# umount /hh\n快照还原\n[root@localhost randy]# lvconvert --merge /dev/ran/snap\n  Merging of volume ran/snap started.\n  ran/ra: Merged: 98.22%\n\n  ran/ra: Merged: 100.00%\n自动挂载\n[root@localhost randy]# mount -a\n查看结果\n[root@localhost randy]# ll /hh\n总用量 20\ndrwx------. 2 root root 16384 11月 29 09:08 lost+found\n-rw-r--r--. 1 root root    47 11月 29 15:21 readme.txt</code></pre>\n\n<h3 id=\"删除逻辑卷\"><a href=\"#删除逻辑卷\" class=\"headerlink\" title=\"删除逻辑卷\"></a>删除逻辑卷</h3><pre><code class=\"highlight plaintext\">[root@localhost randy]# umount /hh\n[root@localhost randy]# vim /etc/fstab\n[root@localhost randy]# lvremove /dev/ran/ra\nDo you really want to remove active logical volume ran/ra? [y/n]: y\n  Logical volume &quot;ra&quot; successfully removed\n[root@localhost randy]# vgremove ran\n  Volume group &quot;ran&quot; successfully removed\n[root@localhost randy]# pvremove /dev/sd[b-c]\n  Labels on physical volume &quot;/dev/sdb&quot; successfully wiped.\n  Labels on physical volume &quot;/dev/sdc&quot; successfully wiped.</code></pre>\n","text":"部署逻辑卷查看当前磁盘 [root@localhost randy]# ls /dev/sd* /dev/sda /dev/sda1 /dev/sda2 /de...","permalink":"/post/LVM逻辑卷管理器","photos":[],"count_time":{"symbolsCount":"8.9k","symbolsTime":"8 mins."},"categories":[],"tags":[{"name":"Linux","slug":"Linux","count":6,"path":"api/tags/Linux.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%83%A8%E7%BD%B2%E9%80%BB%E8%BE%91%E5%8D%B7\"><span class=\"toc-text\">部署逻辑卷</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%89%A9%E5%AE%B9%E9%80%BB%E8%BE%91%E5%8D%B7\"><span class=\"toc-text\">扩容逻辑卷</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BC%A9%E5%B0%8F%E9%80%BB%E8%BE%91%E5%8D%B7\"><span class=\"toc-text\">缩小逻辑卷</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%80%BB%E8%BE%91%E5%8D%B7%E5%BF%AB%E7%85%A7\"><span class=\"toc-text\">逻辑卷快照</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E9%80%BB%E8%BE%91%E5%8D%B7\"><span class=\"toc-text\">删除逻辑卷</span></a></li></ol>","author":{"name":"Randolph","slug":"blog-author","avatar":"/img/log.jpg","link":"/","description":"Knowledge of operation and maintenance, sharing of difficult and miscellaneous diseases","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Fake.Email_kali","uid":"16677ceba435b70d8852ba6ff8cc14f0","slug":"Fake-Email_kali","date":"2022-01-16T16:03:19.000Z","updated":"2024-04-08T05:47:59.000Z","comments":true,"path":"api/articles/Fake-Email_kali.json","keywords":null,"cover":"/img/fmeail.webp","text":"MTP协议 Mail Transport Protocol简单邮件传输协议 (Simple Mail Transfer Protocol, SMTP) Inte...","permalink":"/post/Fake-Email_kali","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"Fake.Email","slug":"Fake-Email","count":1,"path":"api/categories/Fake-Email.json"}],"tags":[{"name":"Fake.Email","slug":"Fake-Email","count":1,"path":"api/tags/Fake-Email.json"}],"author":{"name":"Randolph","slug":"blog-author","avatar":"/img/log.jpg","link":"/","description":"Knowledge of operation and maintenance, sharing of difficult and miscellaneous diseases","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"linux RAD磁盘阵列","uid":"784cfd3583b2ab178009150908334afb","slug":"linux-RAD磁盘阵列","date":"2021-11-22T15:15:12.000Z","updated":"2024-04-08T05:58:46.000Z","comments":true,"path":"api/articles/linux-RAD磁盘阵列.json","keywords":null,"cover":"/img/rad.jpeg","text":"RAID 0、1、5、10方案技术对比RAID级别 最少硬盘 可用容量 读写性能 安全性 0 2 n n 低 追求最大容量和速度，任何一块盘损坏，数据全部异常。...","permalink":"/post/linux-RAD磁盘阵列","photos":[],"count_time":{"symbolsCount":"3.8k","symbolsTime":"3 mins."},"categories":[{"name":"Linux","slug":"Linux","count":5,"path":"api/categories/Linux.json"}],"tags":[{"name":"Linux","slug":"Linux","count":6,"path":"api/tags/Linux.json"}],"author":{"name":"Randolph","slug":"blog-author","avatar":"/img/log.jpg","link":"/","description":"Knowledge of operation and maintenance, sharing of difficult and miscellaneous diseases","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}